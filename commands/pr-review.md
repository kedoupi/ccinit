## PR Review

### 核心作用
按照统一的优先级体系审查 Pull Request，从正确性、安全、性能、架构等维度发现问题并给出可执行的改进建议。

### 适用场景
- 需要系统化评估大型 PR 的风险与质量
- 想明确指出阻断项、建议项、讨论项等不同级别反馈
- 希望生成结构化评论、示例代码与检查清单

### 快速用法
```bash
gh pr view 123 --comments | /pr-review
"请从安全、性能、架构角度审查该 PR，并给出分级意见"
```

可指定侧重：
- 安全审查：`/pr-review --focus security`
- 架构评估：`/pr-review --focus architecture`
- 性能关注：`/pr-review --focus performance`

### 评论分级
- `🔴 critical.must`：阻断级，安全漏洞、数据破坏、服务不可用。
- `🟡 high.imo`：高优先级，潜在缺陷、性能隐患、严重可维护性问题。
- `🟢 medium.imo`：中等优先级，结构优化、可读性、测试不足。
- `🟢 low.nits`：低优先级，风格、命名、注释等细节。
- `🔵 info.q`：提问或背景信息确认。

### 审查流程
1. **预检**：检查 PR 基本信息、关联 Issue、变更范围、CI 状态。
2. **系统审查**：按正确性 → 安全 → 性能 → 架构 → 文档/测试的顺序。
3. **反馈撰写**：定位问题 → 说明影响 → 提供解决方案或示例代码。
4. **后续跟进**：确认修复、复查 CI、记录复盘要点。

### 输出结构（示例）
```
PR 审查报告
━━━━━━━━━━━━━━━━━━━━━━
摘要
- 变更范围 / 风险评估 / 建议优先级

关键发现
1. 🔴 critical.must src/auth/service.ts:123
   - 问题：密码以明文写入日志
   - 建议：改为掩码或移除日志

2. 🟡 high.imo src/api/user.ts:88
   - 问题：存在 N+1 查询
   - 建议：使用 eager loading

改进建议
- 补充测试 / 更新文档 / 重构建议
```

### 常见检查要点
- **正确性**：边界条件、异常处理、数据校验、幂等性。
- **安全**：认证授权、输入验证、敏感数据、日志脱敏。
- **性能**：时间复杂度、N+1、缓存策略、异步/并发风险。
- **架构**：分层依赖、耦合度、接口/抽象、SOLID 原则。
- **文档与测试**：是否覆盖新增场景、更新清单、风险说明。

### 与 Claude 协作
- 提供 `gh pr diff`、`gh pr view --json` 等信息后请求分析。
- 可要求输出带代码片段的 Markdown 评论，直接粘贴到 GitHub。
- 结合 `/task` 或 `/plan` 为重大问题创建后续改进计划。

### 注意事项
- 反馈要客观、具体，并附带理由与解决思路。
- 先处理阻断问题，再讨论建议项，保持节奏可控。
- 若 PR 过大，建议拆分或引导作者提供更多上下文。
