## PR Merge

### 核心作用
在满足质量门禁后自动合并 Pull Request，并遵守分支保护、审批和 CI 要求，确保发布流程安全可靠。

### 适用场景
- CI 全绿、评审通过后希望一键合并
- 想在合并前验证破坏性更改、覆盖率、文档状态等自定义门禁
- 需要统一合并策略（Squash / Merge / Rebase）并清理分支

### 快速用法
```bash
/pr-merge                      # 当前分支对应 PR，验证后合并
/pr-merge --pr 123             # 指定 PR 号
/pr-merge --dry-run            # 仅验证准备情况
/pr-merge --strategy squash    # 指定合并策略（默认 squash）
```

### 必要检查
1. **CI 状态**：所有必需检查通过。
2. **评审决议**：至少一名代码拥有者批准，无 pending 变更请求。
3. **分支状态**：非 Draft，无合并冲突，满足保护策略。
4. **附加门禁（可配置）**：覆盖率、性能基准、安全扫描、文档更新等。

### 合并策略
- `squash`（默认）：压缩提交、删除功能分支。
- `merge`：保留提交记录，适合发布或回滚需求。
- `rebase`：保持线性历史，需确认无冲突。

### 输出示例
```
PR 合并检查
━━━━━━━━━━━━━━━━━━━━━━
PR #256
- CI：✅ 所有必须检查通过
- 评审：✅ Approved
- Draft：否
- 冲突：无

✅ 符合合并条件，采用策略 squash
✅ 合并成功并删除分支
```

### 与 Claude 协作
- 可先请求 Claude 运行 `gh pr checks`、`gh pr view --json reviewDecision` 等命令核对状态。
- 若 `--dry-run` 失败，Claude 会列出阻塞项并给出解决建议。
- 合并完成后，可继续让 Claude 更新发布说明、同步看板任务。

### 注意事项
- 仅在所有门禁通过的情况下执行自动合并，紧急情况下可由管理员使用 `--force`（需项目允许）。
- 如需保留分支，移除 `--delete-branch` 相关步骤。
- 合并前请确认敏感信息已脱敏，避免误入主分支。
