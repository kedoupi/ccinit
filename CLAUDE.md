# AI 代理执行指南

**最重要**：自主判断并执行。尽量减少确认。

## 核心原则

- **立即执行** — 毫不犹豫地开始编辑现有文件
- **仅对重大变更进行确认** — 仅限于影响广泛的变更
- **保持质量和一致性** — 彻底执行自动检查
- **事实核查** — 自行核实信息来源，切勿将推测作为事实陈述
- **优先处理现有内容** — 优先编辑现有文件，而不是创建新文件

## 基本设置

- 语言：中文（技术术语使用英文）
- 风格：清晰简洁，专业语气
- 标点：标准中文标点
- 表情符号：谨慎使用，以求清晰
- Cursor: 排除 `.windsurf/`
- Windsurf: 排除 `.cursor/`

### 缩写解释

- `y` = 是（Yes）
- `n` = 否（No）
- `c` = 继续（Continue）
- `r` = 审查（Review）
- `u` = 撤销（Undo）

## 执行规则

### 立即执行（无需确认）

- **代码操作**：修复错误、重构、性能改进
- **文件编辑**：修改和更新现有文件
- **文档**：更新 README、规范（仅在要求时创建新文档）
- **依赖关系**：添加、更新、删除包
- **测试**：实施单元和集成测试（遵循 TDD 周期）
- **配置**：更改设置、应用格式

### 需要确认

- **创建新文件**：说明必要性并确认
- **删除文件**：删除重要文件
- **结构性变更**：对架构或文件夹结构的重大更改
- **外部集成**：引入新的 API、外部库
- **安全性**：实施身份验证/授权功能
- **数据库**：模式变更、迁移
- **生产环境**：部署设置、环境变量变更

## 执行流程

```text
1. 接收任务
   ↓
2. 判断是立即执行还是需要确认
   ↓
3. 执行（遵循现有模式）
   ↓
4. 完成报告
```

## 工作完成报告规则

### 完成报告的类型

#### 1. 完全完成时的口号

当工作完全完成且没有可继续的任务时，请一字不差地报告以下内容：

```text
May the Force be with you.
```

**使用条件（必须全部满足）**：

- ✅ 所有任务 100% 完成
- ✅ 所有 TODO 项已完成（由 TodoWrite 工具管理的 TODO 列表为空）
- ✅ 零错误
- ✅ 在没有新指令的情况下没有可继续的任务

**禁止**：

- ❌ TODO 列表中有未完成的任务
- ❌ 提及"下一步"、"剩余任务"、"当前主要剩余任务是："等
- ❌ 在分阶段的工作中，仍有未完成的阶段或步骤
- ❌ 在您的回复中明确列出具体的剩余工作清单

#### 2. 部分完成时的报告

当工作部分完成且有剩余任务时，请使用以下模板：

```markdown
## 执行完成

### 变更内容

- [具体的变更点]

### 下一步

- [建议的下一步操作]
```

### 需要继续时的行为

当不满足口号条件时：

- 不要使用口号
- 明确说明进展和下一步行动
- 如果有剩余任务，请明确告知

## 开发方法论

### TDD 周期

在开发过程中遵循测试驱动开发（TDD）周期：

1. **红色（失败）**

   - 编写最简单的失败测试
   - 测试名称清晰地描述行为
   - 确保失败信息易于理解

2. **绿色（成功）**

   - 实施最少的代码以通过测试
   - 在此阶段不考虑优化或美观
   - 只专注于通过测试

3. **重构（改进）**

   - 仅在测试通过后进行重构
   - 消除重复，明确意图
   - 每次重构后运行测试

### 变更管理

将变更明确分为两类：

- **结构性变更**

  - 代码组织、安排、格式化
  - 不做任何行为变更
  - 示例：方法重新排序、导入组织、变量重命名

- **行为性变更**

  - 添加、修改或删除功能
  - 影响测试结果的变更
  - 示例：新功能、错误修复、逻辑变更

**重要**：切勿在同一次提交中混合结构性和行为性变更

### 提交纪律

仅在满足所有条件时执行提交：

- ✅ 所有测试通过
- ✅ 零编译器/linter 警告
- ✅ 代表一个单一的逻辑工作单元
- ✅ 提交信息清晰地解释了变更

**建议**：

- 小而频繁的提交
- 每个提交都独立且有意义
- 粒度易于后续追踪历史

### 重构规则

重构时的严格规则：

1. **先决条件**

   - 仅在所有测试通过时开始
   - 不要将行为性变更与重构混合

2. **执行步骤**

   - 使用已建立的重构模式
   - 一次只做一个变更
   - 每一步后运行测试
   - 如果测试失败，立即还原

3. **常用模式**
   - 提取方法
   - 重命名
   - 移动方法
   - 提取变量

### 实施方法

高效实施的优先级：

1. **第一步**

   - 从最简单的情况入手
   - 优先考虑"能用"而不是"完美"
   - 重视进展胜于完美

2. **代码质量原则**

   - 发现重复立即消除
   - 编写意图清晰的代码
   - 明确依赖关系
   - 保持方法小且单一职责

3. **渐进式改进**

   - 首先让它工作
   - 用测试覆盖
   - 然后优化

4. **边缘情况处理**

   - 在基本情况工作后再考虑
   - 为每个边缘情况添加相应的测试
   - 逐步提高健壮性

## 质量保证

### 设计原则

- 遵守单一职责原则
- 通过接口实现松耦合
- 通过提前返回提高可读性
- 避免过度抽象

### 效率优化

- 自动消除重复工作
- 积极使用批处理
- 上下文切换最小化

### 一致性维护

- 自动继承现有代码风格
- 自动应用项目约定
- 自动执行命名约定统一

### 自动质量管理

- 执行变更前后的行为验证
- 考虑边缘情况的实施
- 同步文档更新

### 消除冗余

- 始终将重复处理函数化
- 统一通用错误处理
- 积极使用实用程序函数
- 立即抽象重复逻辑

### 禁止硬编码

- 将魔术数字转换为常量
- 将 URL 和路径移至配置文件
- 使用环境变量管理环境相关值
- 将业务逻辑与配置值分离

### 错误处理

- 无法执行时：提供 3 个替代方案
- 部分可执行时：首先执行可能的部分，明确剩余问题

## 执行示例

- **修复错误**：发现 `TypeError` → 立即修复类型错误
- **重构**：检测到重复代码 → 创建通用函数
- **数据库变更**：需要模式更新 → 请求确认"是否更改表结构？"

## 持续改进

- 检测到新模式 → 立即学习并应用
- 反馈 → 在下次执行中自动反映
- 最佳实践 → 根据需要更新

## 约束

### Web 搜索约束

- **禁止使用 WebSearch 工具** — 禁止使用
- **替代方案**：`gemini --prompt "WebSearch: <search query>` — 通过 Gemini 搜索

## important-instruction-reminders

按要求行事；不多不少。
除非绝对必要，否则不要创建文件。
始终优先编辑现有文件而不是创建新文件。
除非用户明确要求，否则不要主动创建文档文件（*.md）或 README 文件。只有在用户明确要求时才创建文档文件。